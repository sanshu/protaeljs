/*! protael 0.1.0 2014-07-21 */
function ProtaelBrowser(a,b,c,d,e){Protael(a,b,c,d,e).draw()}Snap.plugin(function(a,b){"use strict";var c=b.prototype;c.toFront=function(){return this.appendTo(this.paper)},c.toBack=function(){return this.prependTo(this.paper)},c.hide=function(){return this.attr({visibility:"hidden"})},c.show=function(){return this.attr({visibility:"visible"})}});var Protael=function(){"use strict";function a(a,b,c){b.a=b.append,b.a("Zoom:"),b.a($('<div class="protael_zoomslider"></div>').slider({value:a.currentScale(),min:.5,max:15,step:.05,slide:function(b,c){a.setZoom(c.value)}})),b.a($("<button>Zoom to fit</button>").button({text:!1,icons:{primary:"ui-icon ui-icon-arrow-4-diag"}}).click(function(){a.zoomToFit()})),b.a($("<button>Zoom to selection</button>").button({text:!1,icons:{primary:"ui-icon ui-icon-arrowthick-2-e-w"}}).click(function(){a.zoomToSelection()})),b.a('Current selection: <input type="text" class="protael_selection_inp" readonly/>'),b.a($('<button id="export">Export</button>').button({text:!1,icons:{primary:"ui-icon-disk"}}).click(function(){$("#xarea").text(a.getConstruct()),$("#xdialog").dialog("open")})),$("#xdialog").dialog({modal:!0,autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close")}}}),b.a($("<button>Reset selection</button>").button({text:!1,icons:{primary:"ui-icon-refresh"}}).click(function(){a.clearSelection()})),b.a("Coloring:"),b.a($("<select><option>Original</option><option>Clustal</option><option>Lesk</option><option>Cinema</option><option>MAEditor</option><option>ALI</option><option>None</option></select>").change(function(){a.setColoringScheme($(this).val())})),c||b.hide(),$(document).tooltip({track:!0,content:function(){var a=$(this);if(a.is("[data-pdb]")){var b=a.data("pdb");return'<img src="http://www.rcsb.org/pdb/images/'+b+'_bio_r_250.jpg">'}return a.is("[title]")?a.attr("title"):a.is("img")?a.attr("alt"):void 0}}),b.a($('<input type="checkbox" id="chkTooltip" checked="true"><label for="chkTooltip">Cursor tooltips</label>').change(function(){a.setShowCursorTooltips($("#chkTooltip").is(":checked"))}))}function b(e,f,h,i,j){if(!(this instanceof b))return new b(e,f,h,i,j);var k=navigator.appVersion,l=this,m='<div class="ui-widget-content protael_resizable" style="width:'+h+"; height:"+i+'" ></div>',n=$(m),o=$('<div class="ui-widget-header ui-corner-all protael_toolbar"></div>'),p='<div width="100%" height="100%" class="protael_svg"><div><div class="protael_slider"></div></div><svg id="'+f+'_svgcanvas" width="100%" height="100%" preserveAspectRatio="xMinYMin meet"><desc>Protael '+b.version+"</desc></svg></div>",q=$(p);$("#"+f).append(n),this.container=f,n.append(o),n.append(q),this.protein=e,d=q.width(),this.controlsEnabled=j,this.controlsEnabled&&$("#"+this.container+" .protael_slider").slider({range:!0,min:1,max:e.sequence.length,values:[1,1],slide:function(a,b){l.setSelection(b.values[0],b.values[1])}}),j&&(n.append('<div id="xdialog" title="Export selection"><textarea id="xarea" cols="40" rows="10"></textarea></div>'),a(this,o,j)),this.selectedx=[-1,-1],this.svgDiv=$("#"+f+" .protael_svg"),this.selectSlider=$("#"+f+" .protael_slider"),this.selectInput=$("#"+f+" .protael_selection_inp"),this.isChrome=k.indexOf("Chrome")>=0||k.indexOf("Opera")>=0,this.currentScaleX=1,this.currentShiftX=0,this.showCursorTooltips=!0,this.paper=new c(f,q.width(),q.height(),this),this.H=g.calcHeight(this.protein),this.W=this.protein.sequence.length,this.paper.setSize(this.W,this.H),this.paper.axis(this.W,10),n.resizable({stop:function(){l.zoomToFit()}})}function c(a,b,c,d){this.protael=d,this.paper=Snap("#"+a+"_svgcanvas"),this.paper.attr({viewBox:"0 0 "+b+" "+c});var e=this.paper;this.viewSet=Snap.set(),this.textSet=Snap.set(),this.overlayFtLabels=Snap.set(),this.createDefs(),this.gAxes=e.g().attr({id:"axes"}),this.gSequences=e.g().attr({Id:"seqs"}),this.gFTracks=e.g().attr({id:"ftracks"}),this.gQTracks=e.g().attr({Id:"qtracks"}),this.seqChars=e.g().attr({id:"seqChars","font-family":"monospace","font-size":"9px","text-anchor":"start","letter-spacing":"0px"}),this.seqLines=e.g().attr({id:"seqLines"}),this.seqLineCovers=e.g().attr({id:"seqLineCovers",opacity:0}),this.seqBGSet=e.g().attr({id:"seqBGSet",opacity:.7}),this.seqLabelsSet=e.g().attr({"font-size":"9px","text-anchor":"start",id:"seqLabels"})}b.version="0.1.0";var d,e={mainSeqHeight:55,featureHeight:15,graphHeight:50,space:20},f=function(){function a(a){return a=a.toLowerCase(),b[a]||b.clustal}var b={clustal:{G:"orange",P:"orange",S:"orange",T:"orange",H:"red",K:"red",R:"red",F:"blue",W:"blue",Y:"blue",I:"green",L:"green",M:"green",V:"green"},lesk:{G:"orange",A:"orange",S:"orange",T:"orange",C:"green",V:"green",I:"green",L:"green",P:"green",F:"green",Y:"green",M:"green",W:"green",N:"magenta",Q:"magenta",H:"magenta",D:"red",E:"red",K:"blue",R:"blue"},maeditor:{A:"lightgreen",G:"lightgreen",C:"green",D:"DarkGreen",E:"DarkGreen ",N:"DarkGreen ",Q:"DarkGreen ",I:"blue",L:"blue",M:"blue",V:"blue",F:"#C8A2C8",W:"#C8A2C8",Y:"#C8A2C8",H:"DarkBlue ",K:"orange",R:"orange",P:"pink",S:"red",T:"red"},cinema:{H:"blue",K:"blue",R:"blue",D:"red",E:"red",S:"green",T:"green",N:"green",Q:"green",A:"white",V:"white",L:"white",I:"white",M:"white",F:"magenta",W:"magenta",Y:"magenta",P:"brown",G:"brown",C:"yellow",B:"grey",Z:"grey",X:"grey"},ali:{A:"grey",R:"grey",N:"grey",D:"grey",C:"grey",E:"grey",Q:"grey",G:"grey",H:"grey",I:"grey",L:"grey",K:"grey",M:"grey",F:"grey",P:"grey",S:"grey",T:"grey",W:"grey",Y:"grey",V:"grey"}};return{getCSchema:a}}();!function(a){function b(a,b,c,d,e,f){var g=(c-a)/2,h=(e-c)/2,i=Math.atan((c-a)/Math.abs(d-b)),j=Math.atan((e-c)/Math.abs(d-f));i=d>b?Math.PI-i:i,j=d>f?Math.PI-j:j;var k=Math.PI/2-(i+j)%(2*Math.PI)/2,l=g*Math.sin(k+i),m=g*Math.cos(k+i),n=h*Math.sin(k+j),o=h*Math.cos(k+j);return{x1:c-l,y1:d+m,x2:c+n,y2:d+o}}a.setSize=function(a,b){var c=this.paper,d=c.attr("viewBox"),e="".concat(b).concat("px");d.height=b,c.attr({height:e,width:a,viewBox:d})},a.getWidth=function(){return this.paper.attr("width")},a.setZoom=function(a){var b=this.protael,c=a/b.currentScaleX,d=this.getWidth();d.indexOf("px")>0&&(d=d.replace(/[^\d.-]/g,""));var e=Math.round(d*c);if(this.setWidth(e),this.viewSet.forEach(function(b){var d=b.attr("x"),e=b.attr("width");if(d)b.attr({x:d*c});else if("line"===b.type){var f=b.attr("x1"),g=b.attr("x2");b.attr({x1:f*c,x2:g*c})}else"path"===b.type&&b.transform("s"+a+" 1 0 0");e&&!isNaN(e)&&b.attr({width:e*c})}),this.textSet.forEach(function(a){var b=a.attr("x");b&&a.attr({x:b*c})}),this.isChrome){var f=this.strechSeq;f.attr({"letter-spacing":"0px"}).hide();var g=f.getBBox().width,h=e-g,i=f.attr("numspaces"),j=h/i+"px",k=f.attr("x");f.attr({x:k*c,"letter-spacing":j}),this.seqChars.attr({"letter-spacing":j})}b.currentScaleX=a,b.currentScaleX>1?this.seqBGSet.show():this.seqBGSet.hide(),b.currentScaleX>7?this.seqChars.show():this.seqChars.hide(),this.overlayFtLabels.forEach(b.currentScaleX>7?function(a){a.hide()}:function(a){a.show()})},a.axis=function(a,b){var c,d,e,f=a/b+1,g=this.protael.H,h=this.paper,i=h.g().attr({id:"axLbls","class":"pl-axeslbl"});for(c=0;f>=c;c++)d=h.line(Math.round(c*b),0,Math.round(c*b),g),c%5===0?(d.attr({"class":"major"}),e=h.text(c*b,8,c*b),this.textSet.push(e),i.add(e)):d.attr({"class":"minor"}),this.gAxes.add(d),this.viewSet.push(d);return this.gAxes.add(i),this.gAxes},a.createDefs=function(){var a=this.paper,b=5,c=8,d=38,e=a.g().attr({id:"gap","stroke-width":2}),f="m 9.943742,1.54515 0,7.665216 C 9,15 8.977801,15 6,18 5.092011,19.329493 0.900884,20.578894 0,22 -0.903141,20.578894 -4.252632,19.379901 -5.160607,18.050408 -7.745849,14.487355 -9.7582132,11.922758 -9.6863207,9.212778 l 0,-7.667628 -5.7594933,0 0,7.665216 c 0.07412,5.544348 3.171965,8.901205 5.6876008,12.525256 2.6545072,3.598566 6.1354302,5.259308 6.0060532,7.136425 L -3.75216,38 4,38 4,28.866878 c -0.129374,-1.874375 3.351556,-3.535283 6.006045,-7.133892 2.518073,-3.62402 5.613376,-6.978272 5.687696,-12.52262 l 0,-7.665216 z";a.path(f).attr({id:"glycan",fill:"#000"}).transform("scale(0.3)").toDefs(),f="m 9.943742,1.54515 0,7.665216 c 0.01858,0.678098 -1.8182777,4.537747 -2.31158,4.024493 L -1.548312,3.388971 -5,6.5 6.022199,18 C 5.11421,19.329493 2.03074,20.719454 1.129856,22.14056 0.226715,20.719454 -4.252632,19.379901 -5.160607,18.050408 -7.745849,14.487355 -9.7582132,11.922758 -9.6863207,9.212778 l 0,-7.667628 -5.7594933,0 0,7.665216 c 0.07412,5.544348 3.171965,8.901205 5.6876008,12.525256 2.6545072,3.598566 6.1354302,5.259308 6.0060532,7.136425 L -3.75216,38 4,38 4,28.866878 c -0.129374,-1.874375 3.351556,-3.535283 6.006045,-7.133892 2.518073,-3.62402 5.613376,-6.978272 5.687696,-12.52262 l 0,-7.665216 z",a.path(f).attr({id:"oliglycan"}).transform("scale(0.3)").toDefs(),f="M 9.943742,1.54515 5.757162,5.359859 4,1.625 l -7,0 -2.311321,3.712778 -4.3749997,-3.792628 -5.7594933,0 5.6876008,8.190472 c 2.6545072,3.598566 6.1354302,1.259308 6.0060532,3.136425 L -3.75216,38 4,38 4,12.866878 C 4,11 7.351556,13.331595 10.006045,9.732986 L 15.693741,1.54515 z",a.path(f).attr({id:"unknownglycan"}).transform("scale(0.3) ").toDefs(),a.line(0,0,0,12).attr({id:"stick","stroke-width":2}).toDefs(),e.add(a.line(0,c,0,d-c)),e.add(a.line(-b,0,0,c)),e.add(a.line(b,0,0,c)),e.add(a.line(-b,d,0,d-c)),e.add(a.line(b,d,0,d-c)),e.toDefs()},a.createUse=function(a,b,c,d){var e=this.paper.el("use").attr({x:b-.5,y:c,"xlink:href":"#"+a}).attr(d);return this.viewSet.push(e),e},a.setWidth=function(a){var b,c=this.paper.attr("viewBox");c.width=a+20,b="".concat(a).concat("px"),this.paper.attr({width:b,viewBox:c}),this.protael.selectSlider.length&&this.protael.selectSlider.width(b)},a.proteinSeqBG=function(a,b,c,d,e){e=1*e-1||0;var f=this.protael,g=this,h=this.paper,i="white";setTimeout(function(){var j,k,l=f.currentScale()||1,m=d?9:3,n=i,o=n,p=1,q=[],r=a.length,s=c;for(j=0;r>j;j++)n=b[j]||i,o!==n&&(o!==i&&(k=h.rect((p+e)*l,s,(j-p)*l,m).attr({fill:o,stroke:o}),q.push(k),g.viewSet.push(k)),p=j,o=n);o!==i&&(k=h.rect((p+e)*l,s,(j-p)*l,m).attr({fill:o,stroke:o}),q.push(k),g.viewSet.push(k)),g.seqBGSet.add(q)},10)},a.proteinSequence=function(a,b,c,d){d=d||{},b=b||10;var e,f=this.paper,g=this,h=d.description,i=f.g().attr({id:"SG_"+h,title:h||""}),j=d.start-1||0,k=this.protael,l=c?15:3,m=f.line(0,b+l/2,this.protael.W,b+l/2).attr({"class":"pl-seqline"}),n=f.rect(0,b,this.protael.W,10).attr({id:"seq_"+h,title:h||"",opacity:0}),o=a.length;i.add(n,m),d.clazz&&n.attr({"class":d.clazz}),d.pdbid&&n.attr({"data-pdb":d.pdbid}),this.seqLineCovers.add(n),this.seqLines.add(m),this.viewSet.push(m,n),c&&(this.isChrome?(this.strechSeq=this.paper.text(j*k.currentScale(),b+8,a.join("")),e=this.strechSeq.getBBox().width,this.strechSeq.attr({uwidth:e,numspaces:a.length}),this.textSet.push(this.strechSeq),this.seqChars.add(this.strechSeq)):setTimeout(function(){if(c){var d,e,h,i=[];for(d=0;o>d;d++)"."!==a[d]&&(e=(j+d)*k.currentScale(),h=f.text(e,b+8,a[d]),i.push(h),g.textSet.push(h));g.seqChars.add(i)}},10))},a.clearColoring=function(){for(var a in this.seqBGSet)this.viewSet.exclude(this.seqBGSet[a]);this.seqBGSet.clear()},a.setColoringScheme=function(a){if(this.clearColoring(),"none"!==a.toLowerCase()){var b,c,d,e,h,i=this.aliTop,j=this.protael.protein,k=j.alidisplay?!0:!1,l=[],m=j.sequence.toUpperCase().split(""),n=35;if("original"===a.toLowerCase()){if(j.seqcolors)for(b=g.splitData(j.seqcolors.data.toUpperCase()),e=m.length;e--;)l[e]=j.seqcolors.colors[b[e]];else this.setColoringScheme("none");if(this.proteinSeqBG(m,l,n,!0),j.alignments)for(c=0,d=j.alignments.length;d>c;c++){if(h=j.alignments[c],l=[],m=h.sequence.split(""),h.color)for(e=m.length;e--;)l[e]=h.color;else if(h.seqcolors){if(b=g.splitData(h.seqcolors.data.toUpperCase()),h.seqcolors.colors)for(e=m.length;e--;)l[e]=h.seqcolors.colors[b[e]];else if(j.seqcolors.colors)for(e=m.length;e--;)l[e]=j.seqcolors.colors[b[e]]}else l=g.getColors(m,f.getCSchema(h.CS||"ALI"));this.proteinSeqBG(m,l,i,k,h.start||0,h.label),i+=10,j.alidisplay&&(i+=5)}}else{var o=f.getCSchema(a);if(l=g.getColors(m,o),this.proteinSeqBG(m,l,n,!0),j.alignments)for(var c in j.alignments)m=j.alignments[c].sequence.split(""),l=g.getColors(m,o),this.proteinSeqBG(m,l,i,k,j.alignments[c].start||0),i+=10,j.alidisplay&&(i+=5)}}},a.featureTrack=function(a,b,c,d,e,f){var g,h,i,j=this.paper,k="pl-ftrack "+(a.clazz||""),l=j.g().attr({id:a.label,"class":k,"font-size":c-8+"px"}),m=a.display||"block",n=a.color||"",o=[],p=0,q=a.features.length;if(this.gFTracks.add(l),o.push(0),d)for(i=0;q>i;i++)g=a.features[i],g&&(t=this.feature(g,g.color||n,m,b,c,l,e,d,f),g.click&&t.click(g.click(g.dbxrefs)));else{a.features.sort(function(a,b){return a.start-b.start});for(var r=JSON.parse(JSON.stringify(a.features)),s=0;r.length>0;)if(g=r.shift())if(h=0,g.draw_level=g.draw_level||0,h=g.draw_level*c,-1===$.inArray(h,o)&&o.push(h),g.draw_level!==p&&(s=0),g.start>=s){var t=this.feature(g,g.color||n,m,b+h,c,l,!0,d,f);g.click&&t.click(g.click),s=g.end,p=g.draw_level}else g.draw_level++,r.push(g)}if(a.showLine){var u="block"===m?0:-c/2+2,v=0+b+c/2-u;for(var h in o){var w=o[h],x=j.line(0,v+w,this.protael.W,v+w).attr({stroke:"#BBB",fill:"#BBB","stroke-width":"1px",title:a.label||""}).toBack();l.prepend(x),this.viewSet.push(x)}}return p},a.feature=function(a,b,c,d,e,f,g,h,i){var j,k,l,m=a.start-1,n=a.end,o="pl-feature",p=this.paper;return"block"===c?k=p.rect(m,d,n-m,e).attr({}):"line"===c&&(k=p.rect(m,d+e/2+4,n-m,3)),b&&k.attr({fill:b}),h&&k.attr({opacity:.6}),a.clazz&&(o+=" "+a.clazz,k.attr({"class":a.clazz})),j=p.g().attr({id:a.label||"",title:a.label,fill:b,"class":o}),j.add(k),g&&(l=p.text((m+n)/2,d+e-5,a.label),l.attr({stroke:"none","class":"pl-feature-label"}),j.append(l),this.textSet.push(l),i&&this.overlayFtLabels.push(l)),f.add(j),this.viewSet.push(k),j},a.quantTrack=function(a,c,d,e){var f,g,h,i,j,k=a.color||"#F00",l=k,m=Math.max.apply(Math,a.values),n=Math.min.apply(Math,a.values),o=-n/(m-n)*100,p="",q=e/(m-n),r=c,s=!1,t=this.protael.W,u=this.paper;for(f=a.values.length;d>=f;f++)a.values[f]=0;if(!a.values&&a.data&&(a.values=a.data.split(a.data.indexOf(",")>0?",":"")),a.values.splice(0,0,0),a.values[d]=0,s)for(g=0,h=t;h>g;g++){if(i=g,j=r+e-a.values[g]*q,g&&g!==h-1){var v=g-1,w=r+e-a.values[g-1]*q,x=g+1,y=r+e-a.values[g+1]*q,z=b(v,w,i,j,x,y);p=p+"C"+[z.x1,z.y1,i,j,z.x2,z.y2].join(",")}g||(p=p+"M0 "+(c+e)+" C"+i+" "+j)}else for(g=0;t>g;g++)i=g,j=r+e-(a.values[g]-n)*q,g&&g!==h-1&&(p=p+"L"+i+", "+j),g||(p=p+"M0 "+(c+e+n*q));Array.isArray(k)&&(1==k.length?l=k[0]:2==k.length?l=u.gradient("l(0, 1, 0, 0)"+k[0]+"-"+k[1]):3==k.length&&(l=u.gradient("l(0, 1, 0, 0)"+k[0]+"-"+k[1]+":"+o+"-"+k[2]))),p=p+"L"+t+" "+(c+e+n*q)+" Z";var A=u.path(p).attr({stroke:k,"stroke-width":.1,"stroke-linejoin":"round","stroke-linecap":"butt","stroke-dasharray":"",fill:l,opacity:".7"}),B=u.text(.1,c+8,a.label).attr({"font-size":"10px","text-anchor":"start"}),C=u.line(0,c,t,c).attr({"class":"pl-chart-top"}),D=u.line(0,c+m*q,t,c+m*q).attr({"class":"pl-chart-center"}),E=u.line(0,c+e,t,c+e).attr({"class":"pl-chart-bottom"}),F=u.g(A,C,E,D,B).attr({id:"qtrack_"+a.label});this.gQTracks.add(F),this.viewSet.push(C),this.viewSet.push(E),this.viewSet.push(D),this.viewSet.push(A),this.textSet.push(B)},a.proteinMarkers=function(a,b){var c,d,e,f,g,h,i,j=this.paper.g().attr({id:"gMarkers"}),k=(a.length,{"font-size":"10px","font-family":"Arial","text-anchor":"middle"});for(c=a.length;c--;)d=a[c],e="bottom"===d.position?26:0,f=d.type?d.type:"glycan",g=d.label?"m_"+d.label:"m_"+c,h=this.createUse(f,d.x,b+e,{id:g,title:d.label?d.label:""}),d.label&&(e="bottom"===d.position?45:0,i=this.paper.text(d.x,b+e,d.label).attr(k),d.color&&i.attr({fill:d.color}),this.textSet.push(i),j.add(i)),d.color&&h.attr({fill:d.color,stroke:d.color}),j.add(h)},a.proteinBridges=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this.paper.g().attr({id:"gBridges","font-size":"10px","font-family":"Arial","text-anchor":"middle","stroke-width":2,"stroke-linejoin":"round","stroke-linecap":"round"}),n=this.paper,o=12,p={},q={fill:"white",stroke:"white"};for(var r in a){if(c=a[r],d=n.g().attr({id:"bridge_"+r}),p={},c.color&&(p={fill:c.color,stroke:c.color}),e=c.start-.5,f=c.end-.5,g=(f+e)/2,h=n.line(e,b,e,b+o).attr(p),this.viewSet.push(h),i=n.line(f,b,f,b+o).attr(p),this.viewSet.push(i),j=n.line(e,b+o,f,b+o).attr(p),this.viewSet.push(j),c.startlabel&&(k=n.text(e,b+21,c.startlabel),c.color&&k.attr({fill:c.color}),this.textSet.push(k),d.add(k)),c.endlabel){var k=n.text(f,b+21,c.endlabel);c.color&&k.attr({fill:c.color}),this.textSet.push(k),d.add(k)}if(d.add(h,i,j),c.type){k=n.text(g,b+15,c.type);var s=c.type.length;l=n.line(g-s/2-1,b+o,g+s/2+1,b+o).attr(q),c.color&&k.attr({fill:c.color}),k.toFront(),this.textSet.push(k),this.viewSet.push(l),d.add(l,k)}m.add(d)}},a.draw=function(a){var b,c,d,f,g=[],h=a.sequence.toUpperCase().split(""),i=(a.alidisplay?!0:!1,35),j=20,k=this.paper,l=[],m=[];if(a.markers&&this.proteinMarkers(a.markers,j),a.bridges&&this.proteinBridges(a.bridges,i+15),a.overlayfeatures){var n=a.overlayfeatures.showLabels||!1;this.featureTrack(a.overlayfeatures,i-5,20,!0,n)}for(this.aliTop=i,this.proteinSequence(h,i,!0),this.proteinSeqBG(h,g,i,!0,"main"),this.protael.isChrome&&(this.strechSeq=this.paper.text(0,30,a.sequence).attr({id:"strechSeq","font-family":"monospace","font-size":"9px","text-anchor":"start","letter-spacing":"0px"}).hide(),this.strechSeq.attr({uwidth:this.strechSeq.getBBox().width,numspaces:h.length})),i+=30,this.gLabels=this.paper.g().attr({"font-size":"14px","text-anchor":"start",id:"cursor"}).hide(),c=a.ftracks?a.ftracks.length:0,b=0;c>b;b++)d=a.ftracks[b].allowOverlap||!1,f=this.featureTrack(a.ftracks[b],i,e.featureHeight,d,!0),i+=e.featureHeight*f+e.space;for(c=a.qtracks?a.qtracks.length:0,b=0;c>b;b++){this.quantTrack(a.qtracks[b],i,this.protael.W,e.graphHeight);var o=k.rect(0,16+i,22,20,4,4).attr({fill:"#000",stroke:"black",color:"white","stroke-width":"2px",opacity:".7"}),p=k.text(0,30+i,"").attr({fill:"white"});this.gLabels.add(o,p),l[b]=p,m[b]=o,a.qtracks[b].topY=i,i+=e.graphHeight+e.space}this.aliTop=i;var q=a.alidisplay?!0:!1;if(a.alignments)for(this.protael.setColoringScheme("Original"),c=a.alignments.length,b=0;c>b;b++){var r=a.alignments[b],s=r.sequence.split("");this.proteinSequence(s,i,q,r),i+=10,a.alidisplay&&(i+=5)}this.gSequences.add(this.seqLabelsSet,this.seqBGSet,this.seqChars,this.seqLines),this.labelsWidth=this.seqLabelsSet.getBBox().width,this.seqBGSet.hide(),this.seqChars.hide().transform("T1, 0"),this.gSequences.toFront(),this.seqLines.toBack(),this.gAxes.toBack(),this.selector=k.rect(-1,0,0,this.protael.H).attr({fill:"#DDD",stroke:"#666","stroke-width":"2px",opacity:.5,id:"selector"}).hide(),this.pointer=k.rect(0,0,2,this.protael.H).attr({fill:"green",stroke:"green",opacity:.7,id:"pointer"}),this.viewSet.push(this.selector);var t=k.rect(0,46,22,20,4,4).attr({fill:"#000",stroke:"black",color:"white","stroke-width":"2px",opacity:.7}),u=k.text(0,60,"").attr({fill:"white"});this.seqLineCovers.toFront();var v=this,w=this.protael,o=k.rect(0,0,w.W,w.H).toBack().attr({stroke:"#fff",opacity:0,id:"blanket"});this.gLabels.add(t,u),k.mousemove(function(b){b=b||window.event;var c=b.offsetX,d=this.container+" #blanket",e=5;if(void 0===c){var f=$(d);c=b.pageX-f.offset().left}var g=Math.round(c+w.currentShiftX);if(!(0>g)&&(v.pointer.attr({x:g+e}).show(),w.showCursorTooltips)){var i=w.toOriginalX(g);u.node.textContent=h[i]+": "+(i+1),g+=e,v.gLabels.transform("T "+g+" 0").show();var j=u.getBBox().width;t.attr({width:j});for(var f in a.qtracks){var k=l[f],n=m[f];k.node.textContent=a.qtracks[f].values[i];var j=k.getBBox().width;n.attr({width:j})}}}).mouseout(function(){v.gLabels.hide(),v.pointer.hide()}),this.viewSet.push(o)}}(c.prototype),b.Paper=c,b.prototype.Utils={},b.prototype.Utils.calcHeight=function(a){var b=e.mainSeqHeight,c=0;return a.ftracks&&a.ftracks.length&&(b+=e.featureHeight*(a.ftracks.length+2)),a.qtracks&&(b+=(e.graphHeight+e.space)*a.qtracks.length),a.alignments&&(c=a.alidisplay?15:10,b+=c*a.alignments.length),b+20},b.prototype.Utils.splitData=function(a){return a.split(a.indexOf(",")>0?",":"")},b.prototype.Utils.getColors=function(a,b){var c,d=[],e=a.length;for(c=0;e>c;c++)d[c]=b[a[c]]||"white";return d};var g=b.prototype.Utils;return function(a){a.draw=function(){return this.paper.draw(this.protein),this.CS||this.setColoringScheme("Original"),this.setZoom(d/this.W),this.clearSelection(),this},a.setSelection=function(a,b){this.selectedx[0]=a,this.selectedx[1]=b;var c=this.toScreenX(b)-this.toScreenX(a-1);return this.paper.selector.attr({width:c,x:this.toScreenX(a-1)+this.currentShiftX}).show(),this.controlsEnabled&&this.selectInput.val(a+":"+b),this},a.clearSelection=function(){this.selectedx=[-1,-1],this.paper.selector.attr({x:0,width:0}).hide().toBack(),this.controlsEnabled&&this.selectInput.val("");var a=this.svgDiv.scrollLeft(),b=$("#"+this.container+" .protael_resizable").width(),c=this.toOriginalX(a+b/2);return c>this.W&&(c=this.W/2),this.controlsEnabled&&this.selectSlider.slider("values",[c-1,c+2]),this},a.translate=function(a){return this.svgDiv.scrollLeft(this.svgDiv.scrollLeft()+a),this},a.zoomIn=function(){return this.setZoom(this.currentScaleX+.1),this},a.zoomOut=function(){return this.setZoom(this.currentScaleX-.1),this},a.zoomToFit=function(){var a=this.svgDiv.width();return this.setZoom(a/this.W),this},a.zoomToSelection=function(){if(-1!==this.selectedx[1]){var a=this.selectedx[1]-this.selectedx[0];this.setZoom(this.svgDiv.width()/a-.2);var b=(this.selectedx[0]+a/2)*this.currentScaleX-this.svgDiv.width()/2;return this.svgDiv.scrollLeft(b),this}},a.setPaperWidth=function(a){return this.paper.setWidth(a),this},a.currentScale=function(){return this.currentScaleX},a.getConstruct=function(){if(-1===this.selectedx[0])return"No selection";var a=this.protein.label||"construct";return">"+a+" "+this.selectedx[0]+":"+this.selectedx[1]+"\n"+this.protein.sequence.substring(this.selectedx[0]-1,this.selectedx[1])},a.toOriginalX=function(a){return Math.round((a+this.currentShiftX)/this.currentScaleX)},a.toScreenX=function(a){return Math.round(a*this.currentScaleX-this.currentShiftX)},a.setShowCursorTooltips=function(a){return a||this.paper.gLabels.hide(),this.showCursorTooltips=a,this},a.setZoom=function(a){return a=Math.min(a,15),a=Math.max(a,.5),this.paper.setZoom(a),$("#"+this.container+" .protael_zoomslider").slider("value",this.currentScaleX),this},a.setColoringScheme=function(a){return this.paper.setColoringScheme(a),this.CS=a,this},a.select=function(a){return Snap.selectAll(a)}}(b.prototype),window.Protael=b,b}();